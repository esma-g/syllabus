<!DOCTYPE html>




<html lang="en-gb">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>CYF&#43;</title>
    <meta name="description" content="A free and open source immersive engineering programme. Practical, hands on projects in Go, distributed systems engineering, site reliability engineering, software engineering. Pace, scale, and complexity." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        animation: fade-in 0.2s;
      }
      @keyframes fade-in {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
     
    <link
      rel="stylesheet"
      href="/bundled.min.f44ec27dd539fe9647de9751483e4bcd.css"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link rel="stylesheet" href="/bundled.min.f44ec27dd539fe9647de9751483e4bcd.css" />
    </noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@300;400;700&family=Major+Mono+Display&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicons/site.webmanifest" />
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <meta name="apple-mobile-web-app-title" content="CYF+" />
    <meta name="application-name" content="CYF+" />
    <meta name="msapplication-TileColor" content="#9f00a7" />
    <meta
      name="msapplication-config"
      content="/favicons/browserconfig.xml"
    />
    <meta name="theme-color" content="#00ff90" />
  </head>
</html>
<body class="is-light-mode">
  <a class="c-skip-link e-button" id="skip-link" href="#main">Skip to main</a>
  <div class="l-layout">
    <header class="l-layout__header l-header">
  <div class="l-header__nav">
    <h1 class="l-header__heading">
      <a class="l-header__home" href="/">CYF&#43;</a>
    </h1>

    <button
      class="l-header__action e-button e-button--icon js-menu-toggle is-fixed"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon l-header__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z"
        />
      </svg>

      <span class="is-invisible">Open Menu.</span>
    </button>
  </div>
</header>
 <nav
  class="l-layout__menu l-menu"
  aria-label="Main Site Links."
  id="site-menu"
  hidden
  tabindex="0"
>
  <div class="l-menu__container">
    <h2 class="l-menu__heading e-heading__2">
      <a href="/" class="l-menu__home">CYF&#43;</a>
    </h2>
    <button
      class="l-menu__action e-button e-button--icon js-menu-toggle"
      id="close-menu"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>

      <span class="is-invisible">Close Menu.</span>
    </button>
    <ul class="l-menu__primary e-list">
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/about">About</a>
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/versions"
          >Versions</a
        >
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/projects"
          >Projects</a
        >
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/primers">Primers</a>
      </li>
    </ul>

    <div class="l-menu__secondary">
      
      <a class="l-menu__link e-link" href="#skip-link">
        <span class="is-invisible">To top</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          width="48px"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="l-menu__icon"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12"
          />
        </svg>
      </a>
      
    </div>
  </div>

  <img
    src="/pictures/depths/dddepth--005.webp"
    alt=""
    class="l-menu__bg"
  />
</nav>

    <main id="main" class="l-layout__main l-main" tabindex="0">
      

<article>
  <header class="l-page__header c-page-header">
    <div class="c-page-header__container">
      <div class="c-page-header__breadcrumbs">
        
<nav class="c-breadcrumbs">
  <ol class="c-breadcrumbs__list">
    <li class="c-breadcrumbs__item">
      <a class="c-breadcrumbs__link" href="/projects/">Projects</a>
    </li>
  </ol>
</nav>


      </div>
      <h1
        class="c-page-header__title e-heading__1 is-invisible"
      >
        Batch Processing
      </h1>
         
      <a
        class="c-page-header__edit e-heading__5 e-link is-none--lt-container"
        href="https://github.com/CodeYourFuture/immersive-go-course/tree/main/projects/batch-processing/README.md"
        >Edit on Github</a
      >
       

  

  


<h2 class="c-lastmod c-page-header__lastmod">
  .Lastmod
  <a href="https://github.com/CodeYourFuture/immersive-go-course/tree/main/batch-processing">
    <time datetime="2023-01-08T15:59:51Z">2023-01-08T15:59:51Z</time>
  </a>
</h2>

  
      <section class="c-page-header__toc c-toc" id="toc">
        <nav id="TableOfContents">
  <ol>
    <li><a href="#learning-objectives">Learning objectives:</a></li>
    <li><a href="#project">Project</a>
      <ol>
        <li><a href="#run-the-scaffolding-code">Run the scaffolding code</a></li>
        <li><a href="#test-the-scaffolding-code">Test the scaffolding code</a></li>
      </ol>
    </li>
    <li><a href="#specificiation">Specificiation</a></li>
    <li><a href="#how-to">How-to</a>
      <ol>
        <li><a href="#reading-a-csv">Reading a CSV</a></li>
        <li><a href="#downloading-the-file">Downloading the file</a></li>
        <li><a href="#image-processing">Image processing</a></li>
        <li><a href="#cloud-storage-s3">Cloud storage (S3)</a>
          <ol>
            <li><a href="#role--policy">Role + policy</a></li>
          </ol>
        </li>
        <li><a href="#session">Session</a></li>
        <li><a href="#uploading">Uploading</a></li>
      </ol>
    </li>
    <li><a href="#extensions">Extensions</a></li>
  </ol>
</nav>
      </section>
      
    </div>
  </header>

  <section class="l-page__main c-copy"><p>In this project, you&rsquo;ll build a simple image processing pipeline: reading a list of image URLs from a CSV file, downloading each image, processing it, and uploading it to cloud storage.</p>
<blockquote>
<p>⚠️ This project requires you to have access to an Amazon AWS account, with permissions to configure IAM and S3. Ask on CYF Slack for help with that.</p>
</blockquote>
<blockquote>
<p>⚠️ You need a GitHub repo to complete this because we&rsquo;ll be using <a href="https://docs.github.com/en/actions">GitHub Actions</a>.</p>
</blockquote>
<h2 id="learning-objectives">Learning objectives:</h2>
<ul>
<li>What is batch processing and how does it differ from building servers?</li>
<li>How do we use Go to use run existing software to complete tasks?</li>
<li>What is cloud storage technology and how do we read from it &amp; upload data to it?</li>
<li>How do we read, modify and extend existing code?
<!-- - How do we build resilience into batch processing software? -->
<!-- - How do we deploy batch processing tasks in the cloud? -->
</li>
</ul>
<p>Timebox: 2 days</p>
<h2 id="project">Project</h2>
<p>This project starts with some scaffolding code already written. We&rsquo;ll be using a tool called <a href="https://imagemagick.org/">ImageMagick</a> to process the images. The specific details of it are not important, so this is provided for us.</p>
<p>ImageMagick is software written in C. We&rsquo;re going to call out to this code from Go using a package called <a href="https://github.com/gographics/imagick">imagick</a>, which acts an an interface between our Go code and the ImageMagick code.</p>
<p>As a result of this dependency on ImageMagick, we&rsquo;re going to run this whole project in Docker. That means, rather than use <code>go run</code> or <code>go test</code>, we&rsquo;ll build and run a Docker container that has ImageMagick correctly installed.</p>
<blockquote>
<p>It&rsquo;s possible to install ImageMagick on your computer to run this outside of docker, but you don&rsquo;t <em>need</em> to do that.</p>
</blockquote>
<p>The Docker commands get a bit complex so we can do things like run tests and <em>see</em> the output of the code, so we&rsquo;re not going to type the Docker commands ourselves.</p>
<p>Instead, to run the code, we use a tool called <a href="https://www.gnu.org/software/make/">Make</a>. Make enables us to build code without knowing the details of how that is done, because these details are recorded in the <code>Makefile</code>. In that way it&rsquo;s similar to Docker - when using Make you store the complexity of what to run in a <code>Makefile</code>, and when using Docker you store the complexity of how to run the code in a container in a <code>Dockerfile</code>.</p>
<p>Read a <a href="https://www.gnu.org/software/make/">quick introduction to Make</a> and then install it for your computer. On macOS, it&rsquo;s likely that you have it already — try typing <code>make</code> into your terminal. It should output something like <code>make: no target specified</code>. If not (e.g. it says something like <code>command not found: make</code>), you need to <a href="https://www.freecodecamp.org/news/install-xcode-command-line-tools/">install the command-line tools</a>.</p>
<blockquote>
<p><strong>Important</strong>: you don&rsquo;t need to understand <code>make</code> in depth. We&rsquo;re only going to use the very simplest features. In particular, you shouldn&rsquo;t have to edit the <code>Makefile</code> we&rsquo;ve supplied other than exactly as we describe (but feel free if you want to!)</p>
</blockquote>
<h3 id="run-the-scaffolding-code">Run the scaffolding code</h3>
<p>Now we can run the code, using <code>make run</code>. This command looks in the <code>Makefile</code> for a &ldquo;target&rdquo; called <code>run</code>, and then executes the code it finds there. In our case, that looks something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Makefile" data-lang="Makefile"><span style="display:flex;"><span><span style="color:#a6e22e">run</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	docker build --target run -t run .
</span></span><span style="display:flex;"><span>	docker run --rm run
</span></span></code></pre></div><p>We build a docker image and tag it <code>run</code>, and then run it.</p>
<p>Let&rsquo;s do that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>&gt; make run
</span></span><span style="display:flex;"><span>mkdir -p outputs
</span></span><span style="display:flex;"><span>docker build --target run -t run .
</span></span><span style="display:flex;"><span>[+] Building 1.1s (21/21) FINISHED
</span></span><span style="display:flex;"><span> =&gt; [internal] load build definition from Dockerfile                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring dockerfile: 37B                                                                  0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load .dockerignore                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring context: 2B                                                                      0.0s
</span></span><span style="display:flex;"><span> =&gt; resolve image config for docker.io/docker/dockerfile:1                                           0.5s
</span></span><span style="display:flex;"><span> =&gt; CACHED docker-image://docker.io/docker/dockerfile:1@sha256:9ba7531bd80fb0a858632727cf7a112fbfd1  0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load .dockerignore                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load build definition from Dockerfile                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load metadata for docker.io/library/golang:1.19-bullseye                              0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load build context                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring context: 716B                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; [base  1/12] FROM docker.io/library/golang:1.19-bullseye                                         0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  2/12] RUN apt-get update &amp;&amp;     apt-get install -y wget build-essential pkg-confi  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  3/12] RUN apt-get -q -y install libjpeg-dev libpng-dev libtiff-dev     libgif-dev  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  4/12] RUN cd &amp;&amp;     wget https://github.com/ImageMagick/ImageMagick6/archive/6.9.  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  5/12] WORKDIR /app                                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  6/12] COPY go.mod ./                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  7/12] COPY go.sum ./                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  8/12] RUN go mod download                                                          0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  9/12] COPY *.go ./                                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 10/12] COPY inputs /inputs                                                          0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 11/12] RUN mkdir -p /outputs                                                        0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 12/12] RUN go build -o /out                                                         0.0s
</span></span><span style="display:flex;"><span> =&gt; exporting to image                                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; exporting layers                                                                              0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; writing image sha256:155cb66e4ea4ce0d7ec39c451343130a0852ccb7ad312917ac3ec1b0c5b26aa6         0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; naming to docker.io/library/run                                                               0.0s
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>docker run \
</span></span><span style="display:flex;"><span>		--mount type=bind,source=&#34;$(pwd)/outputs&#34;,target=/outputs \
</span></span><span style="display:flex;"><span>		--rm run
</span></span><span style="display:flex;"><span>2022/10/04 10:45:31 processing: &#34;/inputs/gradient.jpg&#34; to &#34;/outputs/gradient_bw.jpg&#34;
</span></span><span style="display:flex;"><span>2022/10/04 10:45:32 processed: &#34;/inputs/gradient.jpg&#34; to &#34;/outputs/gradient_bw.jpg&#34;
</span></span></code></pre></div><p>Here we can see the docker image building. The first time we run this, it will take a while and we won&rsquo;t see lots of <code>CACHED</code> messages. The time is spent installing ImageMagick into the Docker container and building the app.</p>
<p>One it&rsquo;s run, we should now have a new local directory — <code>outputs</code> — which contains an image <code>gradient_bw.jpg</code> which is a grayscale version of the <code>gradient.jpg</code> file that&rsquo;s in the <code>inputs</code> directory.</p>
<p>Something interesting has happened here! Our docker container wrote the file back to <em>our</em> filesystem. It was able to do this because our docker command <a href="https://docs.docker.com/storage/bind-mounts/">mounted</a> the <code>outputs</code> directory from our host (your computer) onto the <code>/outputs</code> directory inside the docker container. When the go application wrote the processed file to <code>/outputs/gradient_bw.jpg</code>, it was actually writing to your filesystem, outside of the container.</p>
<p>This mount feature allows us to test the code and see the outputs. Otherwise, they&rsquo;d be stuck inside the Docker container. To find out more about this, read the <a href="https://docs.docker.com/storage/">managing data with Docker</a> guide.</p>
<h3 id="test-the-scaffolding-code">Test the scaffolding code</h3>
<p>There&rsquo;s also a <code>make</code> command for testing, and there are a few tests for the image manipulation code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>&gt; make test
</span></span><span style="display:flex;"><span>docker build --target test -t test .
</span></span><span style="display:flex;"><span>[+] Building 1.7s (21/21) FINISHED
</span></span><span style="display:flex;"><span> =&gt; [internal] load build definition from Dockerfile                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring dockerfile: 37B                                                                  0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load .dockerignore                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring context: 2B                                                                      0.0s
</span></span><span style="display:flex;"><span> =&gt; resolve image config for docker.io/docker/dockerfile:1                                           1.2s
</span></span><span style="display:flex;"><span> =&gt; CACHED docker-image://docker.io/docker/dockerfile:1@sha256:9ba7531bd80fb0a858632727cf7a112fbfd1  0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load .dockerignore                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load build definition from Dockerfile                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load metadata for docker.io/library/golang:1.19-bullseye                              0.0s
</span></span><span style="display:flex;"><span> =&gt; [base  1/12] FROM docker.io/library/golang:1.19-bullseye                                         0.0s
</span></span><span style="display:flex;"><span> =&gt; [internal] load build context                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; transferring context: 716B                                                                    0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  2/12] RUN apt-get update &amp;&amp;     apt-get install -y wget build-essential pkg-confi  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  3/12] RUN apt-get -q -y install libjpeg-dev libpng-dev libtiff-dev     libgif-dev  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  4/12] RUN cd &amp;&amp;     wget https://github.com/ImageMagick/ImageMagick6/archive/6.9.  0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  5/12] WORKDIR /app                                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  6/12] COPY go.mod ./                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  7/12] COPY go.sum ./                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  8/12] RUN go mod download                                                          0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base  9/12] COPY *.go ./                                                                 0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 10/12] COPY inputs /inputs                                                          0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 11/12] RUN mkdir -p /outputs                                                        0.0s
</span></span><span style="display:flex;"><span> =&gt; CACHED [base 12/12] RUN go build -o /out                                                         0.0s
</span></span><span style="display:flex;"><span> =&gt; exporting to image                                                                               0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; exporting layers                                                                              0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; writing image sha256:7f24030e5dc71ed23f98885644321c76b3d6709f7140391940ff06f486a33372         0.0s
</span></span><span style="display:flex;"><span> =&gt; =&gt; naming to docker.io/library/test                                                              0.0s
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>docker run \
</span></span><span style="display:flex;"><span>		--rm test
</span></span><span style="display:flex;"><span>=== RUN   TestGrayscaleMockError
</span></span><span style="display:flex;"><span>--- PASS: TestGrayscaleMockError (0.00s)
</span></span><span style="display:flex;"><span>=== RUN   TestGrayscaleMockCall
</span></span><span style="display:flex;"><span>--- PASS: TestGrayscaleMockCall (0.00s)
</span></span><span style="display:flex;"><span>PASS
</span></span><span style="display:flex;"><span>ok  	github.com/CodeYourFuture/immersive-go-course/batch-processing	0.011s
</span></span></code></pre></div><p>This will have run much faster, because all the steps are cached by Docker. This is called the <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#leverage-build-cache">build cache</a>.</p>
<p>Neat! We&rsquo;ve now got the application and the tests running in Docker.</p>
<h2 id="specificiation">Specificiation</h2>
<p>So now we&rsquo;ve got some running code, let&rsquo;s get started.</p>
<p>We want a <strong>CLI tool</strong> that:</p>
<ul>
<li>reads an input CSV containing URLs</li>
<li>downloads images by URL</li>
<li>processes them using ImageMagick to make them monochrome/grayscale</li>
<li>uploads the results to <a href="https://aws.amazon.com/s3/">Amazon AWS S3 cloud storage</a></li>
<li>writes an output CSV describing what it did</li>
</ul>
<p>It should run like this: <code>go run . --input input.csv --output output.csv</code></p>
<p>You should modify and extend the <code>main.go</code> file we&rsquo;ve supplied in this directory, re-using some bits of it.</p>
<p>An example input CSV file would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>url
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80
</span></span></code></pre></div><p>Or as a table:</p>
<table>
<thead>
<tr>
<th>url</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
</tr>
<tr>
<td><a href="https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
</tr>
<tr>
<td><a href="https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
</tr>
</tbody>
</table>
<p>An example output CSV would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>url,input,output,s3url
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80,/tmp/1664885100393-5577006791947779410.jpg,/tmp/1664885100394-8674665223082153551.jpg,https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885100394-8674665223082153551.jpg
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80,/tmp/1664885101726-6129484611666145821.jpg,/tmp/1664885101726-4037200794235010051.jpg,https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885101726-4037200794235010051.jpg
</span></span><span style="display:flex;"><span>https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80,/tmp/1664885102225-3916589616287113937.jpg,/tmp/1664885102225-6334824724549167320.jpg,https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885102225-6334824724549167320.jpg
</span></span></code></pre></div><p>Or as a table:</p>
<table>
<thead>
<tr>
<th>url</th>
<th>input</th>
<th>output</th>
<th>s3url</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1506815444479-bfdb1e96c566?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
<td>/tmp/1664885100393-5577006791947779410.jpg</td>
<td>/tmp/1664885100394-8674665223082153551.jpg</td>
<td><a href="https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885100394-8674665223082153551.jpg">https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885100394-8674665223082153551.jpg</a></td>
</tr>
<tr>
<td><a href="https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1540979388789-6cee28a1cdc9?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
<td>/tmp/1664885101726-6129484611666145821.jpg</td>
<td>/tmp/1664885101726-4037200794235010051.jpg</td>
<td><a href="https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885101726-4037200794235010051.jpg">https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885101726-4037200794235010051.jpg</a></td>
</tr>
<tr>
<td><a href="https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80">https://images.unsplash.com/photo-1533738363-b7f9aef128ce?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80</a></td>
<td>/tmp/1664885102225-3916589616287113937.jpg</td>
<td>/tmp/1664885102225-6334824724549167320.jpg</td>
<td><a href="https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885102225-6334824724549167320.jpg">https://immersive-go-course-batch-processing.s3.eu-west-1.amazonaws.com/1664885102225-6334824724549167320.jpg</a></td>
</tr>
</tbody>
</table>
<p>The tool should (in order of priority):</p>
<ol>
<li>Write thorough logs (<code>log.Println</code> and <code>log.Printf</code>) to describe what it is doing, including errors</li>
<li>Validate the input CSV to ensure it only has <strong>one</strong> column, <code>url</code></li>
<li>Gracefully handle failures &amp; continue to process the input CSV even if one row fails</li>
<li>Support a configurable AWS region and S3 bucket via environment variables <code>AWS_REGION</code> and <code>S3_BUCKET</code></li>
</ol>
<h2 id="how-to">How-to</h2>
<p>Most of getting this project build is up to you. However, here are some pointers for things you are going to need.</p>
<h3 id="reading-a-csv">Reading a CSV</h3>
<p>The built-in <a href="https://pkg.go.dev/encoding/csv"><code>encoding/csv</code></a> package is the one to use to read and write the CSV files.</p>
<h3 id="downloading-the-file">Downloading the file</h3>
<p>We can use the the standard <code>http</code> package to download the image. Things to watch out for:</p>
<ul>
<li>HTTP requests can fail - remember to catch the error!</li>
<li>HTTP requests can &ldquo;succeed&rdquo; but with a non-200 status code. Think about what that could mean!</li>
<li>How can you make sure the downloaded data is an image, and not some other of file?</li>
</ul>
<h3 id="image-processing">Image processing</h3>
<p>Most of the ImageMagick code, which grayscales the image, is written for you. This shouldn&rsquo;t change too much.</p>
<h3 id="cloud-storage-s3">Cloud storage (S3)</h3>
<p>The specification asks you to upload the images to <a href="https://aws.amazon.com/s3/">Amazon AWS S3 cloud storage</a>. S3 is a cloud service designed to store huge amounts of data and files in a secure, scalable and cost-effective way.</p>
<p>The basic organisation of S3 is simple. At the top level of S3 is the <strong>bucket</strong>. Data (&ldquo;objects&rdquo;) are stored within these buckets in folders, like a normal file system. Read the <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html">high-level guide to S3</a>.</p>
<p>You will need to create a bucket — call it anything you like. Pay attention to which <a href="https://cloudacademy.com/blog/aws-regions-and-availability-zones-the-simplest-explanation-you-will-ever-find-around/#:~:text=What%20are%20AWS%20Regions%3F,host%20their%20cloud%20infrastructure%20there.">AWS region</a> you create it in – you will need this later.</p>
<p>You can make it publically accessible to the internet, so that you or anyone can view the images that are uploaded, with a policy like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;PublicAccess&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;s3:GetObject&#34;</span>, <span style="color:#e6db74">&#34;s3:GetObjectVersion&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::[NAME OF BUCKET]/*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>⚠️ Public means public. <strong>DO NOT</strong> upload anything sensitive to the bucket.</p>
</blockquote>
<p>Use the <a href="https://github.com/aws/aws-sdk-go">AWS SDK for Go</a> to interact with Amazon S3.</p>
<p>You will need to set up credentials so that your docker image can write to S3. The best way to do that is to:</p>
<ul>
<li>Create a role + policy to allow uploads to the bucket</li>
<li>Allow your AWS user account to use the role</li>
<li>Make your AWS credentials available to the Docker container</li>
</ul>
<h4 id="role--policy">Role + policy</h4>
<p><a href="https://us-east-1.console.aws.amazon.com/iamv2/home#/policies">Create a Policy</a> <code>S3ReadWriteGoCourse</code> with the following configuration, which allows reading and writing to the bucket.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;ListObjectsInBucket&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [<span style="color:#e6db74">&#34;s3:ListBucket&#34;</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [<span style="color:#e6db74">&#34;arn:aws:s3:::[NAME OF BUCKET]&#34;</span>]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;AllObjectActions&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;s3:*Object&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [<span style="color:#e6db74">&#34;arn:aws:s3:::[NAME OF BUCKET]/*&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://us-east-1.console.aws.amazon.com/iamv2/home#/roles">Create a Role</a> <code>GoCourseLambdaUserReadWriteS3</code> associated with the <code>S3ReadWriteGoCourse</code> Policy. Set up the Trust Relationships of this policy as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;AWS&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::[YOUR AWS USER ID]:root&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;sts:AssumeRole&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Service&#34;</span>: <span style="color:#e6db74">&#34;lambda.amazonaws.com&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;sts:AssumeRole&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Once that&rsquo;s done, you need local credentials:</p>
<ol>
<li>Install the <a href="https://aws.amazon.com/cli/">AWS CLI</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Follow this guide</a> to set up your credentials locally</li>
</ol>
<p>Then change the <code>Makefile</code> to <a href="https://docs.docker.com/storage/bind-mounts/">mount</a> your <code>.aws</code> directory into the Docker container, in the <code>root</code> user&rsquo;s home directory (<code>/root/.aws</code>). When using the Go SDK, it will automatically find these credentials and use them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Makefile" data-lang="Makefile"><span style="display:flex;"><span><span style="color:#a6e22e">run</span><span style="color:#f92672">:</span> outputs
</span></span><span style="display:flex;"><span>	docker ...
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        --mount type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$$<span style="color:#e6db74">(echo </span>$$<span style="color:#e6db74">HOME)/.aws&#34;</span>,target<span style="color:#f92672">=</span>/root/.aws <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		...
</span></span></code></pre></div><p>You&rsquo;ll need to say which AWS region the S3 bucket is located in. Do that with the <code>AWS_REGION</code> environment variable. You can supply environment variables to the Docker commands directly in the <code>Makefile</code>&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Makefile" data-lang="Makefile"><span style="display:flex;"><span><span style="color:#a6e22e">run</span><span style="color:#f92672">:</span> outputs
</span></span><span style="display:flex;"><span>	docker ...
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        -e AWS_REGION<span style="color:#f92672">=</span>eu-west-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		...
</span></span></code></pre></div><p>&hellip; or use an <a href="https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file">env file</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Makefile" data-lang="Makefile"><span style="display:flex;"><span><span style="color:#a6e22e">run</span><span style="color:#f92672">:</span> outputs
</span></span><span style="display:flex;"><span>	docker ...
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>		--env-file docker_env <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        ...
</span></span></code></pre></div><p>Here&rsquo;s an example <code>docker_env</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span>AWS_REGION<span style="color:#f92672">=</span>eu-west-1
</span></span></code></pre></div><h3 id="session">Session</h3>
<p>We&rsquo;ll need to set up an AWS session using your Role. To do that, we give it the <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">ARN</a> of the Role, which you can from the Role&rsquo;s page in the <a href="https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles">AWS IAM dashboard</a>. It&rsquo;s best to also pass this to the Docker container via the environment, as we did with the <code>AWS_REGION</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Get the Role ARN
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">awsRoleArn</span> <span style="color:#f92672">:=</span> <span style="color:#960050;background-color:#1e0010">???</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Set up S3 session
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#960050;background-color:#1e0010">???</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create the credentials from AssumeRoleProvider to assume the role
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// referenced by the ARN.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">creds</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stscreds</span>.<span style="color:#a6e22e">NewCredentials</span>(<span style="color:#a6e22e">sess</span>, <span style="color:#a6e22e">awsRoleArn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create service client value configured for credentials
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// from assumed role.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">svc</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s3</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">sess</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">aws</span>.<span style="color:#a6e22e">Config</span>{<span style="color:#a6e22e">Credentials</span>: <span style="color:#a6e22e">creds</span>})
</span></span></code></pre></div><h3 id="uploading">Uploading</h3>
<p>The example code on the <a href="https://github.com/aws/aws-sdk-go">AWS SDK for Go</a> README will be helpful!</p>
<h2 id="extensions">Extensions</h2>
<p>To take this project further, add these requirements:</p>
<ol>
<li>The tool should write an output CSV with the URLs that failed, in a format that could be used as input: <code>go run . --input input.csv --output output.csv --output-failed failed.csv</code></li>
<li>Failures in downloading and uploading the images can be temporary: introduce a retry-with-backoff strategy to make the tool more resilient to temporary failures</li>
<li>Do not re-upload the same image to S3
<ul>
<li>Can you do this without storing anything in a database?</li>
</ul>
</li>
<li>Do not download &amp; process the same image
<ul>
<li>Can you also do this without storing anything in a database?</li>
</ul>
</li>
<li>To speed up the tool, process and upload in parallel using <a href="https://go.dev/tour/concurrency/1">goroutines</a>
<ul>
<li>Think about how many goroutines to start - what are the limiting factors?</li>
</ul>
</li>
</ol>
</section>

  
<footer class="c-page-footer c-copy">
  <h4 class="c-page-footer__section">
    <a
      class="c-page-footer__section-link e-link"
      href="/projects"
      >projects</a
    >
  </h4>
   
  <nav class="c-page-footer__section-nav">
    <a
      class="e-button e-button--icon c-page-footer__edit"
      href="https://github.com/CodeYourFuture/immersive-go-course/tree/main/projects/batch-processing/README.md"
      ><svg
        role="presentation"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"
        />
      </svg>
      <span class="is-invisible">Edit this page on GitHub</span></a
    >
    
    
  </nav>
</footer>


</article>


    </main><footer class="l-layout__footer l-footer">
  <a
    class="l-footer__github e-button e-button--icon"
    href="https://github.com/CodeYourFuture/immersive-go-course/"
  >
    <svg
      focusable="false"
      class="e-button__icon"
      role="presentation"
      viewbox="0 0 98 96"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"
        fill="currentColor"
      />
    </svg>
    <span class="is-invisible">Find us on GitHub</span>
  </a>
  <p class="l-footer__impressum e-heading__6">
    This
    <a href="https://github.com/CodeYourFuture/immersive-go-course/"
      >free and open source engineering programme</a
    >
    is a project of
    <a href="https://codeyourfuture.io">Code Your Future</a>
    <br />
    This work is licensed under a Creative Commons Attribution-ShareAlike 4.0
    International License.
  </p>
  <button
    id="mode-toggle"
    class="e__button--toggle e-button--icon l-footer__mode"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="e-icon e__button__icon e-icon--moon"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
      />
    </svg>

    <span class="is-invisible">Toggle between light and dark mode</span>
  </button>
</footer>

  

<script>
  function randomBG() {
    const style = document.createElement("style");
    style.textContent = `body, html {background-image:url("\/pictures/svgs/neons/nnneon.svg"),url("\/pictures/svgs/quads/qqquad-5.svg"),radial-gradient(circle,var(--theme-color--paper) 0%,var(--theme-color--block) 50%,var(--theme-color--paper) 100%);
      background-size: cover;
    }`;

    document.head.appendChild(style);
  }

  window.addEventListener("load", randomBG);
</script>


<script src="/scripts/app.min.js" defer></script>


</div>
</body>
