<!DOCTYPE html>




<html lang="en-gb">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>CYF&#43;</title>
    <meta name="description" content="A free and open source immersive engineering programme. Practical, hands on projects in Go, distributed systems engineering, site reliability engineering, software engineering. Pace, scale, and complexity." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        animation: fade-in 0.2s;
      }
      @keyframes fade-in {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
     
    <link
      rel="stylesheet"
      href="/bundled.min.f44ec27dd539fe9647de9751483e4bcd.css"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link rel="stylesheet" href="/bundled.min.f44ec27dd539fe9647de9751483e4bcd.css" />
    </noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@300;400;700&family=Major+Mono+Display&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicons/site.webmanifest" />
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <meta name="apple-mobile-web-app-title" content="CYF+" />
    <meta name="application-name" content="CYF+" />
    <meta name="msapplication-TileColor" content="#9f00a7" />
    <meta
      name="msapplication-config"
      content="/favicons/browserconfig.xml"
    />
    <meta name="theme-color" content="#00ff90" />
  </head>
</html>
<body class="is-light-mode">
  <a class="c-skip-link e-button" id="skip-link" href="#main">Skip to main</a>
  <div class="l-layout">
    <header class="l-layout__header l-header">
  <div class="l-header__nav">
    <h1 class="l-header__heading">
      <a class="l-header__home" href="/">CYF&#43;</a>
    </h1>

    <button
      class="l-header__action e-button e-button--icon js-menu-toggle is-fixed"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon l-header__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z"
        />
      </svg>

      <span class="is-invisible">Open Menu.</span>
    </button>
  </div>
</header>
 <nav
  class="l-layout__menu l-menu"
  aria-label="Main Site Links."
  id="site-menu"
  hidden
  tabindex="0"
>
  <div class="l-menu__container">
    <h2 class="l-menu__heading e-heading__2">
      <a href="/" class="l-menu__home">CYF&#43;</a>
    </h2>
    <button
      class="l-menu__action e-button e-button--icon js-menu-toggle"
      id="close-menu"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>

      <span class="is-invisible">Close Menu.</span>
    </button>
    <ul class="l-menu__primary e-list">
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/about">About</a>
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/versions"
          >Versions</a
        >
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/projects"
          >Projects</a
        >
      </li>
      <li class="l-menu__item e-list__item">
        <a class="l-menu__link e-link e-heading__1" href="/primers">Primers</a>
      </li>
    </ul>

    <div class="l-menu__secondary">
      
      <a class="l-menu__link e-link" href="#skip-link">
        <span class="is-invisible">To top</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          width="48px"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="l-menu__icon"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12"
          />
        </svg>
      </a>
      
    </div>
  </div>

  <img
    src="/pictures/depths/dddepth--005.webp"
    alt=""
    class="l-menu__bg"
  />
</nav>

    <main id="main" class="l-layout__main l-main" tabindex="0">
      

<article>
  <header class="l-page__header c-page-header">
    <div class="c-page-header__container">
      <div class="c-page-header__breadcrumbs">
        
<nav class="c-breadcrumbs">
  <ol class="c-breadcrumbs__list">
    <li class="c-breadcrumbs__item">
      <a class="c-breadcrumbs__link" href="/projects/">Projects</a>
    </li>
  </ol>
</nav>


      </div>
      <h1
        class="c-page-header__title e-heading__1 is-invisible"
      >
        Output and Error Handling
      </h1>
         
      <a
        class="c-page-header__edit e-heading__5 e-link is-none--lt-container"
        href="https://github.com/CodeYourFuture/immersive-go-course/tree/main/projects/output-and-error-handling/README.md"
        >Edit on Github</a
      >
       

  

  


  
      <section class="c-page-header__toc c-toc" id="toc">
        <nav id="TableOfContents">
  <ol>
    <li><a href="#learning-objectives">Learning Objectives:</a></li>
    <li><a href="#project">Project</a>
      <ol>
        <li><a href="#the-program">The program</a></li>
        <li><a href="#standard-out-and-standard-error">Standard out and standard error</a>
          <ol>
            <li><a href="#standard-out-and-standard-error-in-go">Standard out and standard error in Go</a></li>
            <li><a href="#when-to-write-to-standard-outerror">When to write to standard out/error</a></li>
            <li><a href="#standard-out">Standard out</a></li>
            <li><a href="#standard-error">Standard error</a></li>
          </ol>
        </li>
        <li><a href="#exit-codes">Exit codes</a></li>
        <li><a href="#handling-errors-in-your-code">Handling errors in your code</a>
          <ol>
            <li><a href="#1-propagating-the-error-to-the-calling-function">1. Propagating the error to the calling function</a></li>
            <li><a href="#context-is-valuable">Context is valuable</a></li>
            <li><a href="#2-working-around-the-error-to-recover-from-it">2. Working around the error to recover from it</a></li>
            <li><a href="#3-terminating-the-program-completely">3. Terminating the program completely</a></li>
            <li><a href="#4-ignoring-the-error">4. Ignoring the error</a></li>
          </ol>
        </li>
        <li><a href="#back-to-our-program">Back to our program</a>
          <ol>
            <li><a href="#timesleep">time.Sleep</a>
              <ol>
                <li><a href="#if-were-going-to-sleep-for-more-than-1-second">If we’re going to sleep for more than 1 second:</a></li>
                <li><a href="#if-the-server-tells-us-we-should-sleep-for-more-than-5-seconds">If the server tells us we should sleep for more than 5 seconds:</a></li>
                <li><a href="#if-we-cant-determine-how-long-to-sleep-for">If we can’t determine how long to sleep for:</a></li>
                <li><a href="#when-to-stop">When to stop</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#make-sure-that">Make sure that:</a></li>
      </ol>
    </li>
  </ol>
</nav>
      </section>
      
    </div>
  </header>

  <section class="l-page__main c-copy"><p>In this project you&rsquo;re going to get familiar with conventions around output and exit codes. You will learn about error handling, and how to apply these in the <a href="https://go.dev/">Go programming language</a>.</p>
<p>Timebox: 3 days</p>
<h2 id="learning-objectives">Learning Objectives:</h2>
<ul>
<li>Write to standard out and standard error</li>
<li>Exit programs with conventional exit codes</li>
<li>Explain when to propagate errors</li>
<li>Decide when to wrap errors, and terminate due to errors.</li>
</ul>
<h2 id="project">Project</h2>
<p>Most programs can run into problems. Sometimes these problems are recoverable, and sometimes not.</p>
<p>We will write a program which may encounter several kinds of error. We will handle these errors. We will tell the user about these errors, and make that information easy to consume.</p>
<h3 id="the-program">The program</h3>
<p>In this project, we have been supplied with a server. Our server code lives in the server subdirectory of this project. Run it by <code>cd</code>ing into that directory, and running <code>go run</code>. The server is an HTTP server, which listens on port 8080 and responds in a few different ways:</p>
<ul>
<li>
<p>If you make an HTTP GET request to it, it will respond with the current weather. When this happens, you should display it to the user on the terminal.</p>
</li>
<li>
<p>Sometimes this server will overload and respond with a status code 429. When this happens, the client should:</p>
<ol>
<li>wait the amount of time indicated in the <code>Retry-After</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> response header, and</li>
<li>attempt the request again.</li>
</ol>
</li>
<li>
<p>Sometimes, this server will drop a connection before responding.When this happens:</p>
<p><em>You should assume:</em></p>
<ol>
<li>the server is non-responsive.</li>
<li>making more requests to it could make things worse.</li>
</ol>
<p><em>The client should:</em></p>
<ol>
<li>give up its request</li>
<li>tell the user something irrecoverable went wrong.</li>
</ol>
</li>
</ul>
<p>Have a read of the server code. Make sure you understand what it’s doing, and what kinds of responses you may need to handle.</p>
<p>We won&rsquo;t propose changes to the server code as part of this project. This server is intentionally buggy because we sometimes need to handle bad responses. We may, however, want to make edits to it while you’re developing your client to help you better manually test out your code (randomness is hard to test against!).</p>
<p>Our final client code should work against the original server code.</p>
<p>We’re going to focus on how we handle errors, and how we present output to the user.</p>
<h3 id="standard-out-and-standard-error">Standard out and standard error</h3>
<p>Terminal programs can write output to two places: standard out and standard error. Standard out is sometimes called standard output.</p>
<p>Think of these as “files” you can write to. These files are connected to your terminal by default. What you write to these files will display in your terminal.</p>
<p>You can connect, or redirect, these “files” somewhere else. Run this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>echo hello &gt; /tmp/the-output-from-echo
</span></span></code></pre></div><p><code>echo</code>’s job is to write something to standard out. But if you run this command, you won’t see &ldquo;hello&rdquo; output to the terminal. Instead, it will get written to the file <code>/tmp/the-output-from-echo</code>. You redirected echo’s standard out to the file in the path. If you <code>cat /tmp/the-output-from-echo</code> you’ll see &ldquo;hello&rdquo; written in that file.</p>
<p>You can redirect standard error by writing <code>2&gt;</code> instead of <code>&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>echo hello 2&gt; /tmp/error-from-echo
</span></span></code></pre></div><p>In this example, you’ll still see &ldquo;hello&rdquo; on your terminal. This is because you didn’t redirect standard out anywhere. Also notice that <code>/tmp/error-from-echo</code> was created, but is empty. This is because <code>echo</code> didn’t write anything to standard error.</p>
<p>You can redirect both by using both redirect instructions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>echo hello &gt; /tmp/file-1 2&gt; /tmp/file-2
</span></span></code></pre></div><p>Often, we want to pass the output of our program to some other program or file for further processing. Standard error is a place you can write information which a user may want, but which you don&rsquo;t want to pass forward.</p>
<p>The user might want to know about a problem or progress messages explaining what’s happening. These are important messages, but they aren&rsquo;t helpful for your forward process.</p>
<p>Imagine your program writes out a series of scores, one per line. Next, you write those scores to a file for another program to analyse.</p>
<p>You have two different use cases: As a user, you want to know why your program appears to be hanging or failing. As a consumer of the output, you only want the scores. If the output file had &ldquo;Waiting for HTTP request… or &ldquo;Server error&rdquo; printed in it, that would be annoying to process.</p>
<p>What about when something goes wrong? Say, your network connection goes down and you cannot fetch your scores. In your score-recording program, you may want to assume that anything it outputs is a number. You might need to add numbers together. Reporting your problem on standard error means you won’t try to add the error string &ldquo;Network was down&rdquo; to a number.</p>
<h4 id="standard-out-and-standard-error-in-go">Standard out and standard error in Go</h4>
<p>In go, we access standard out and standard error with <code>os.Stdout</code> and <code>os.Stderr</code>.</p>
<p>Write to them by writing code like <code>fmt.Fprint(os.Stdout, &quot;Hello&quot;)</code> or <code>fmt.Fprint(os.Stderr, &quot;Something went wrong&quot;)</code>. The “F” before “printf” stands for “file”. We’re saying “print some string to a file I’ll specify as the first argument”. In Unix systems, we often like to pretend anything we read or write is a file.</p>
<p>More often, we’ll write <code>fmt.Print(&quot;Hello&quot;)</code>. This is the same as writing <code>fmt.Fprint(os.Stdout, &quot;Hello&quot;)</code>. If you look at the Go standard library source code, you can see it’s literally the same. But we can choose to write to other locations, and <em>sometimes</em> we <em>should</em>. This is why we are thinking about <code>Stdout</code> now.</p>
<h4 id="when-to-write-to-standard-outerror">When to write to standard out/error</h4>
<p>As a rule, write the <em>intended</em> output of your program to standard out. Write anything that isn’t the intended output of your program to standard error.</p>
<p>Some things you may write to standard error:</p>
<ul>
<li>Progress messages explaining what the program is doing.</li>
<li>Error information about something that went wrong.</li>
</ul>
<p>Thinking about our program we’re going to write, that means we’re likely to write:</p>
<h4 id="standard-out">Standard out</h4>
<p>The current weather. It’s what our program is for.</p>
<h4 id="standard-error">Standard error</h4>
<ul>
<li>A message saying that we’ve been asked to wait and retry later. It’s a progress message, not the intended output of our program.</li>
<li>Error information if the server seems broken. It’s not the intended output of our program; it’s diagnostic information.</li>
</ul>
<h3 id="exit-codes">Exit codes</h3>
<p>By convention, most programs exit with an exit code of <code>0</code> when they complete successfully. Programs exit with any number that isn’t <code>0</code> when they fail.</p>
<p>Often a specific program will attach specific meaning to specific non-zero exit codes. <code>1</code> may mean “You didn’t specify all the flags I needed”. <code>2</code> may mean “A remote server couldn’t give me information I needed”. But these meanings belong to that program. There are no general conventions for specific non-0 exit codes across different programs.</p>
<p>By default, your program will exit with exit code <code>0</code> unless you tell it to do otherwise, or it crashes.</p>
<p>In Go, you can choose what code to exit your program with by calling <a href="https://pkg.go.dev/os#Exit"><code>os.Exit</code></a>. After calling <code>os.Exit</code>, your program stops and can’t do anything else.</p>
<p>From a terminal, you can check the exit code of a process you just ran by inspecting the environment variable <code>$?</code>. In this example, <code>pwd</code> is a successful command, and <code>cd /doesnotexist</code> is an unsuccessful one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>% pwd
</span></span><span style="display:flex;"><span>/tmp
</span></span><span style="display:flex;"><span>echo $?
</span></span><span style="display:flex;"><span>0
</span></span><span style="display:flex;"><span>% cd /doesnotexist
</span></span><span style="display:flex;"><span>cd: no such file or directory: /doestnotexist
</span></span><span style="display:flex;"><span>% echo $?
</span></span><span style="display:flex;"><span>1
</span></span></code></pre></div><p>Many common utility programs document their exit codes in their manpages. You can access by running <code>man [command-name]</code><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>man cat
</span></span></code></pre></div><p>shows the somewhat vague but still useful:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>EXIT STATUS
</span></span><span style="display:flex;"><span>     The cat utility exits 0 on success, and &gt;0 if an error occurs.
</span></span></code></pre></div><p>Or the same for <code>curl</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>man curl
</span></span></code></pre></div><p>shows lots of very specific information:</p>
<details><summary>Click to expand the full output of the exit codes section of <code>man curl</code></summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>EXIT CODES
</span></span><span style="display:flex;"><span>       There are a bunch of different error codes and their corresponding error messages that may appear under error conditions. At the time of this writing, the exit codes are:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       0      Success. The operation completed successfully according to the instructions.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       1      Unsupported protocol. This build of curl has no support for this protocol.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       2      Failed to initialize.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       3      URL malformed. The syntax was not correct.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       4      A feature or option that was needed to perform the desired request was not enabled or was explicitly disabled at build-time. To make curl able to do this, you probably need another build of libcurl.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       5      Could not resolve proxy. The given proxy host could not be resolved.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       6      Could not resolve host. The given remote host could not be resolved.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       7      Failed to connect to host.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       8      Weird server reply. The server sent data curl could not parse.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       9      FTP access denied. The server denied login or denied access to the particular resource or directory you wanted to reach. Most often you tried to change to a directory that does not exist on the server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       10     FTP accept failed. While waiting for the server to connect back when an active FTP session is used, an error code was sent over the control connection or similar.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       11     FTP weird PASS reply. Curl could not parse the reply sent to the PASS request.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       12     During an active FTP session while waiting for the server to connect back to curl, the timeout expired.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       13     FTP weird PASV reply, Curl could not parse the reply sent to the PASV request.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       14     FTP weird 227 format. Curl could not parse the 227-line the server sent.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       15     FTP cannot use host. Could not resolve the host IP we got in the 227-line.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       16     HTTP/2 error. A problem was detected in the HTTP2 framing layer. This is somewhat generic and can be one out of several problems, see the error message for details.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       17     FTP could not set binary. Could not change transfer method to binary.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       18     Partial file. Only a part of the file was transferred.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       19     FTP could not download/access the given file, the RETR (or similar) command failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       21     FTP quote error. A quote command returned error from the server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       22     HTTP page not retrieved. The requested URL was not found or returned another error with the HTTP error code being 400 or above. This return code only appears if --fail is used.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       23     Write error. Curl could not write data to a local filesystem or similar.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       25     FTP could not STOR file. The server denied the STOR operation, used for FTP uploading.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       26     Read error. Various reading problems.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       27     Out of memory. A memory allocation request failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       28     Operation timeout. The specified time-out period was reached according to the conditions.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       30     FTP PORT failed. The PORT command failed. Not all FTP servers support the PORT command, try doing a transfer using PASV instead!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       31     FTP could not use REST. The REST command failed. This command is used for resumed FTP transfers.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       33     HTTP range error. The range &#34;command&#34; did not work.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       34     HTTP post error. Internal post-request generation error.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       35     SSL connect error. The SSL handshaking failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       36     Bad download resume. Could not continue an earlier aborted download.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       37     FILE could not read file. Failed to open the file. Permissions?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       38     LDAP cannot bind. LDAP bind operation failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       39     LDAP search failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       41     Function not found. A required LDAP function was not found.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       42     Aborted by callback. An application told curl to abort the operation.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       43     Internal error. A function was called with a bad parameter.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       45     Interface error. A specified outgoing interface could not be used.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       47     Too many redirects. When following redirects, curl hit the maximum amount.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       48     Unknown option specified to libcurl. This indicates that you passed a weird option to curl that was passed on to libcurl and rejected. Read up in the manual!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       49     Malformed telnet option.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       52     The server did not reply anything, which here is considered an error.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       53     SSL crypto engine not found.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       54     Cannot set SSL crypto engine as default.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       55     Failed sending network data.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       56     Failure in receiving network data.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       58     Problem with the local certificate.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       59     Could not use specified SSL cipher.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       60     Peer certificate cannot be authenticated with known CA certificates.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       61     Unrecognized transfer encoding.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       63     Maximum file size exceeded.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       64     Requested FTP SSL level failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       65     Sending the data requires a rewind that failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       66     Failed to initialise SSL Engine.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       67     The user name, password, or similar was not accepted and curl failed to log in.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       68     File not found on TFTP server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       69     Permission problem on TFTP server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       70     Out of disk space on TFTP server.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       71     Illegal TFTP operation.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       72     Unknown TFTP transfer ID.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       73     File already exists (TFTP).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       74     No such user (TFTP).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       77     Problem reading the SSL CA cert (path? access rights?).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       78     The resource referenced in the URL does not exist.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       79     An unspecified error occurred during the SSH session.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       80     Failed to shut down the SSL connection.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       82     Could not load CRL file, missing or wrong format.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       83     Issuer check failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       84     The FTP PRET command failed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       85     Mismatch of RTSP CSeq numbers.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       86     Mismatch of RTSP Session Identifiers.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       87     Unable to parse FTP file list.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       88     FTP chunk callback reported error.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       89     No connection available, the session will be queued.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       90     SSL public key does not matched pinned public key.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       91     Invalid SSL certificate status.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       92     Stream error in HTTP/2 framing layer.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       93     An API function was called from inside a callback.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       94     An authentication function returned an error.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       95     A problem was detected in the HTTP/3 layer. This is somewhat generic and can be one out of several problems, see the error message for details.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       96     QUIC connection error. This error may be caused by an SSL library error. QUIC is the protocol used for HTTP/3 transfers.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       XX     More error codes will appear here in future releases. The existing ones are meant to never change.
</span></span></code></pre></div></details>
<h3 id="handling-errors-in-your-code">Handling errors in your code</h3>
<p>When writing code, we often need to handle the possibility that an error has occurred.</p>
<p>This may be an explicit error returned from a function. When you make a <a href="https://pkg.go.dev/net/http#Client.Get"><code>GET</code></a> request, <code>Get</code> returns an error alongside the response. This error may be nil, but will be non-nil if, for instance, the server was down.</p>
<p>Alternatively, this may be something which we detect, but which other code didn’t tell us was an error. If we make a <code>GET</code> request to a server which returns a <code>429</code> status code, the error will be nil. By looking at <a href="https://pkg.go.dev/net/http#Response"><code>Response.StatusCode</code></a> we can see that something went wrong which we may need to handle.</p>
<p>When encountering or detecting errors, there are typically four options for handling them:</p>
<ol>
<li><strong>Propagating</strong> the error to the calling function. (And possibly wrapping it with some extra contextual information.)</li>
<li><strong>Working around</strong> the error to recover from it.</li>
<li><strong>Terminating</strong> the program completely.</li>
<li><strong>Ignoring</strong> the error. (Sometimes an error actually doesn’t matter.)</li>
</ol>
<p>When we should do each of these isn&rsquo;t always obvious, but here are some guidelines:</p>
<h4 id="1-propagating-the-error-to-the-calling-function">1. Propagating the error to the calling function</h4>
<p>Propagation is our default behaviour. If we don’t know how to handle an error, we should early-return from our function, handing the error to the caller.</p>
<blockquote>
<p>This means that when function Alf calls function Betty, and Betty goes wrong, Betty hands her error to Alf.</p>
</blockquote>
<p>Often times, we want to wrap the error to provide more context. For instance, say we have the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">password</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">readPassword</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readPassword</span>() (<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">password</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;.some-file&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> string(<span style="color:#a6e22e">password</span>), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If the password file doesn&rsquo;t exist, the error message</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>open .some-file: no such file or directory
</span></span></code></pre></div><p>is less useful than an error message like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>failed to read password file: open .some-file: no such file or directory
</span></span></code></pre></div><h4 id="context-is-valuable">Context is valuable</h4>
<p>By wrapping the error with more contextual information, you help the person seeing the error understand:</p>
<ul>
<li><em>what</em> went wrong</li>
<li><em>why</em> it failed</li>
<li>and what they need to <em>do</em> to fix the situation</li>
</ul>
<p>With this in mind, we may write <code>readPassword</code> instead like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readPassword</span>() (<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">password</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;.some-file&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;failed to read password file: %w&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> string(<span style="color:#a6e22e">password</span>), <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Learn more about creating and wrapping errors in <a href="https://earthly.dev/blog/golang-errors/">Effective Error Messages in Go</a>.</p>
<h4 id="2-working-around-the-error-to-recover-from-it">2. Working around the error to recover from it</h4>
<p>Sometimes, an error may be expected, or may be recoverable. Suppose we have some expensive computation we want to do, but which may have already been done and saved to a file. We may try to read the file. If we encounter an error that the file doesn’t exist, we may know how to compute the answer we need instead.</p>
<p>This kind of behaviour will depend on the problem domain you’re solving. There isn’t a general rule for when to write workarounds.</p>
<h4 id="3-terminating-the-program-completely">3. Terminating the program completely</h4>
<blockquote>
<p>When user input can terminate your program, user input can reduce your service’s capacity. This is dangerous.</p>
</blockquote>
<p>When we run into errors, there’s often nothing we can do about them.</p>
<p>Let&rsquo;s imagine we’re running a server. Our error happened when processing one request. We don’t want to end our program! We want to respond to that request saying an error happened. But we also want to keep trying to process other requests.</p>
<p>In other situations it may make sense to end our program and exit (with a non-<code>0</code> status code). Some examples are when starting up a server, or writing a program that does a one-off task. In these cases we aren&rsquo;t responding to user inputs.</p>
<p>Where we exit is worth thinking about. We generally don’t want to call <code>os.Exit</code> from anywhere except our main function.</p>
<p>There are a few reasons for this:</p>
<ol>
<li>If we call <code>os.Exit</code>, there’s no way any code can handle that or recover. Let’s say we started calling <code>os.Exit</code> in some other function. It’s possible we’ll end up in the future calling that function from a request handler. If so, we’ll end up terminating the whole server because we couldn&rsquo;t handle one request. This will probably cause an outage, because no one will be able to talk to our server any more.</li>
<li>When writing unit tests, we generally don’t want our program to exit. If you call <code>os.Exit</code> inside a unit test, it will stop running. In general, don&rsquo;t call <code>os.Exit</code> from any code called from a test.</li>
</ol>
<p><strong>Only call <code>os.Exit</code> from your main function.</strong></p>
<p>Code changes a lot over time. Writing an <code>os.Exit</code> call creates a function that isn&rsquo;t safe to call from other places. Your future self, or someone else, could call your function without realising this. The easiest way to avoid this is to use the rule: only ever call <code>os.Exit</code> from your main function. Everything else should propagate any errors they encounter.</p>
<h4 id="4-ignoring-the-error">4. Ignoring the error</h4>
<p>It may seem to you that you can ignore errors. Be suspicious of this idea.</p>
<p>It is true that occasionally an error actually doesn’t matter at all. But this is rare, and you should be wary if you think this is the case. Programmers cause many real-life bugs by ignoring or poorly handling errors.</p>
<p>Read <a href="https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-yuan.pdf">Simple Testing Can Prevent Most Critical Failures</a> to learn more about this. It&rsquo;s worth a read.</p>
<hr>
<h3 id="back-to-our-program">Back to our program</h3>
<p>Recall the server that gives us the weather.</p>
<p>Our task is to write a client, in Go, which makes HTTP requests to that server and tells the user about the weather.</p>
<p>We should focus in this project on handling errors and retries.</p>
<p>If the server replies with a retryable error, we will retry it appropriately. For a <code>429</code> response code, this means:</p>
<ol>
<li>reading the Retry-After response header</li>
<li>calling <code>time.Sleep</code> until the appropriate time has passed</li>
<li>trying again.</li>
</ol>
<p>Make sure all error messages are clear and useful to the user, that we&rsquo;re properly printing to standard out or standard error when appropriate, and that our program always exits with an appropriate exit code.</p>
<h4 id="timesleep">time.Sleep</h4>
<h5 id="if-were-going-to-sleep-for-more-than-1-second">If we’re going to sleep for more than 1 second:</h5>
<p>We should notify the user that things may be a bit slow because we’re doing a retry.</p>
<h5 id="if-the-server-tells-us-we-should-sleep-for-more-than-5-seconds">If the server tells us we should sleep for more than 5 seconds:</h5>
<p>We should give up and tell the user we can’t get them the weather.</p>
<h5 id="if-we-cant-determine-how-long-to-sleep-for">If we can’t determine how long to sleep for:</h5>
<p>You should decide whether we should sleep for some amount of time (and if so what) and then retry, or give up. Make sure to write down the reasons for your decision.</p>
<h5 id="when-to-stop">When to stop</h5>
<p>If the server terminates our connection, we will give up and tell the user that we can’t get them the weather.</p>
<h3 id="make-sure-that">Make sure that:</h3>
<ol>
<li>all error messages are clear and useful to the user,</li>
<li>we’re properly printing to standard out or standard error when appropriate</li>
<li>our program always exits with an appropriate exit code.</li>
</ol>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Learn about <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After">the <code>Retry-After</code> header on MDN</a>. This header has two formats: delay in seconds, or a timestamp.)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>If you find yourself stuck in a manpage, pressing <code>q</code> will exit from it.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</section>

  
<footer class="c-page-footer c-copy">
  <h4 class="c-page-footer__section">
    <a
      class="c-page-footer__section-link e-link"
      href="/projects"
      >projects</a
    >
  </h4>
   
  <nav class="c-page-footer__section-nav">
    <a
      class="e-button e-button--icon c-page-footer__edit"
      href="https://github.com/CodeYourFuture/immersive-go-course/tree/main/projects/output-and-error-handling/README.md"
      ><svg
        role="presentation"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="e-button__icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"
        />
      </svg>
      <span class="is-invisible">Edit this page on GitHub</span></a
    >
    
    
  </nav>
</footer>


</article>


    </main><footer class="l-layout__footer l-footer">
  <a
    class="l-footer__github e-button e-button--icon"
    href="https://github.com/CodeYourFuture/immersive-go-course/"
  >
    <svg
      focusable="false"
      class="e-button__icon"
      role="presentation"
      viewbox="0 0 98 96"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"
        fill="currentColor"
      />
    </svg>
    <span class="is-invisible">Find us on GitHub</span>
  </a>
  <p class="l-footer__impressum e-heading__6">
    This
    <a href="https://github.com/CodeYourFuture/immersive-go-course/"
      >free and open source engineering programme</a
    >
    is a project of
    <a href="https://codeyourfuture.io">Code Your Future</a>
    <br />
    This work is licensed under a Creative Commons Attribution-ShareAlike 4.0
    International License.
  </p>
  <button
    id="mode-toggle"
    class="e__button--toggle e-button--icon l-footer__mode"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="e-icon e__button__icon e-icon--moon"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
      />
    </svg>

    <span class="is-invisible">Toggle between light and dark mode</span>
  </button>
</footer>

  

<script>
  function randomBG() {
    const style = document.createElement("style");
    style.textContent = `body, html {background-image:url("\/pictures/svgs/neons/nnneon.svg"),url("\/pictures/svgs/quads/qqquad-5.svg"),radial-gradient(circle,var(--theme-color--paper) 0%,var(--theme-color--block) 50%,var(--theme-color--paper) 100%);
      background-size: cover;
    }`;

    document.head.appendChild(style);
  }

  window.addEventListener("load", randomBG);
</script>


<script src="/scripts/app.min.js" defer></script>


</div>
</body>
